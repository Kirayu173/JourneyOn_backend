
# 🧭 智能旅游App设计与开发

## 技术选型说明文档

### 一、项目概述

本项目旨在设计并实现一款以 **行程为导向** 的「智能旅游App」，通过多阶段智能体协作，为用户提供从 **旅行前规划** 、**旅行中陪伴**到**旅行后总结**的一体化智能服务。

系统分为前端移动应用与后端智能体服务两部分，整体采用“ **多智能体 + 知识图谱 + 深度学习** ”的设计思路，基于 LangGraph 实现智能体的分阶段编排与记忆流转，使智能体可全流程参与用户的旅行体验。

---

### 二、总体架构设计

#### 1. 架构模式

* **总体架构** ：前后端分离 + 智能体编排架构
* **后端架构** ：FastAPI + LangGraph + LangChain + PostgreSQL
* **前端架构** ：React Native + Expo + RESTful API
* **部署方式** ：轻量化容器化部署（Docker / Railway / Render）

#### 2. 系统分层图

```
┌────────────────────────────┐
│        前端移动App (Expo)   │
│  · React Native 界面         │
│  · 行程创建、AI助手、报告页   │
│  · 与后端通过REST API交互    │
└──────────────┬─────────────┘
               │ HTTPS / JSON
┌──────────────▼─────────────┐
│         FastAPI 后端服务     │
│  · 用户、行程、聊天接口      │
│  · 调用 LangGraph 智能体编排 │
│  · 工具层：天气、地图、搜索   │
└──────────────┬─────────────┘
               │
┌──────────────▼─────────────┐
│   LangGraph 智能体编排层     │
│  ├─ PreTripAgent（行前助手） │
│  ├─ OnTripAgent（行中助手）  │
│  └─ PostTripAgent（行后助手）│
│  · 状态流转与记忆共享        │
└──────────────┬─────────────┘
               │
┌──────────────▼─────────────┐
│ 数据与知识层                 │
│  · PostgreSQL（结构化数据）  │
│  · Qdrant / ChromaDB（向量库）│
│  · Redis（上下文缓存）       │
└────────────────────────────┘
```

---

### 三、前端技术选型

| 模块     | 技术/框架                                             | 理由                                           |
| -------- | ----------------------------------------------------- | ---------------------------------------------- |
| 前端框架 | **React Native + Expo**                         | 学习曲线低、可跨平台（iOS/Android）、生态完善  |
| UI组件库 | **React Native Paper**/**Shadcn/ui RN版** | 提供现代化风格组件，快速搭建UI                 |
| 状态管理 | **Zustand**/**Redux Toolkit**             | 简洁易用的状态管理方案                         |
| 网络通信 | **Axios**                                       | 与后端FastAPI进行RESTful通信                   |
| 路由系统 | **React Navigation**                            | 支持多页面跳转（行程页 / 智能助手页 / 报告页） |
| 存储     | **AsyncStorage**                                | 本地缓存行程信息、登录态等                     |
| 设备能力 | **Expo Location / Permissions**                 | 获取用户当前位置、权限管理                     |
| 开发工具 | **Expo CLI + VSCode**                           | 快速启动与热更新                               |

#### 前端模块划分

| 模块                   | 功能说明                   |
| ---------------------- | -------------------------- |
| **登录注册模块** | 用户身份管理、Token保存    |
| **行程管理模块** | 创建/查看/编辑行程         |
| **AI助手模块**   | 与不同阶段智能体对话       |
| **旅行报告模块** | 旅行后报告与偏好展示       |
| **个人中心模块** | 用户信息、历史记录、收藏等 |

---

### 四、后端技术选型

| 模块                 | 技术栈                                         | 理由                                        |
| -------------------- | ---------------------------------------------- | ------------------------------------------- |
| **Web框架**    | **FastAPI**                              | 高性能异步框架，API设计简单清晰             |
| **数据库**     | **PostgreSQL**                           | 支持地理扩展（PostGIS），结构化行程数据存储 |
| **ORM**        | **SQLAlchemy 2.x + Alembic**             | ORM建模与迁移便捷                           |
| **缓存系统**   | **Redis**                                | 存储聊天上下文与会话状态                    |
| **智能体框架** | **LangGraph + LangChain**                | 多阶段智能体编排、状态机控制、记忆流转      |
| **知识库**     | **Qdrant / Chroma**                      | 存储旅行偏好、文本向量化数据                |
| **外部API**    | **高德地图 / 天气API / 酒店航班API**     | 获取实时地理与旅行信息                      |
| **模型接入**   | **OpenAI API / Ollama / 通义千问 / GLM** | LLM调用实现智能体对话                       |
| **文件存储**   | **MinIO / 本地静态文件服务**             | 存储报告PDF、行程图片等                     |

---

### 五、智能体层设计（LangGraph + LangChain）

| 阶段   | 智能体名称              | 核心职责                           | 工具调用                      |
| ------ | ----------------------- | ---------------------------------- | ----------------------------- |
| 旅行前 | **PreTripAgent**  | 协助用户规划路线、预算、住宿、交通 | 天气、航班、酒店API、知识检索 |
| 旅行中 | **OnTripAgent**   | 提供实时导航、景点讲解、餐饮推荐   | 地图、餐厅搜索、景点评价      |
| 旅行后 | **PostTripAgent** | 生成旅行报告、总结偏好、更新知识库 | Qdrant知识入库、报告生成工具  |

#### LangGraph 节点流转示意：

```
[Start] 
  ↓
[PreTripAgent] ──► 用户确认计划
  ↓
[OnTripAgent]  ──► 旅行结束
  ↓
[PostTripAgent]
  ↓
[End]
```

#### 智能体内部结构（以旅行前Agent为例）：

* **Prompt模板** ：基于LangChain的 `ChatPromptTemplate`
* **工具集成** ：`Tool`组件封装天气/酒店/航班API
* **记忆模块** ：`ConversationBufferMemory`
* **输出解析** ：`PydanticOutputParser`

---

### 六、API 设计（FastAPI）

| 功能         | 请求方式 | 路径                                  | 简介               |
| ------------ | -------- | ------------------------------------- | ------------------ |
| 用户注册登录 | POST     | `/api/auth/login`                   | 用户身份认证       |
| 创建行程     | POST     | `/api/trip/create`                  | 新建行程           |
| 获取行程     | GET      | `/api/trip/{trip_id}`               | 查看行程详情       |
| 进入阶段     | POST     | `/api/trip/{trip_id}/start/{phase}` | 进入某旅行阶段     |
| 智能体对话   | POST     | `/api/agent/chat`                   | 调用当前阶段智能体 |
| 获取旅行报告 | GET      | `/api/trip/{trip_id}/report`        | 查看旅行总结报告   |

---

### 七、部署与运行环境

| 环境     | 技术                        | 说明                             |
| -------- | --------------------------- | -------------------------------- |
| 运行环境 | Python 3.11 / Node.js 20+   | 前后端开发环境                   |
| 模型环境 | OpenAI API / Ollama（本地） | LLM推理服务                      |
| 数据库   | PostgreSQL 15 / Redis 7     | 数据存储与缓存                   |
| 向量库   | Qdrant / Chroma             | 偏好与知识管理                   |
| 部署     | Docker Compose              | 一键部署FastAPI + DB + LangGraph |
| 移动端   | Expo Build                  | 打包iOS/Android版本              |
| 开发工具 | VSCode / Postman / Expo Go  | 调试与测试工具                   |

---

### 八、系统运行流程概述

1. 用户登录后创建新行程（输入出发地、目的地、预算、天数等）；
2. 系统进入  **旅行前阶段** ，激活 `PreTripAgent` 提供规划建议；
3. 用户确认计划后，进入  **旅行中阶段** ，由 `OnTripAgent` 实时陪伴；
4. 旅行结束后，进入  **旅行后阶段** ，`PostTripAgent` 生成报告与偏好；
5. 系统将偏好数据嵌入知识库，用于后续推荐优化。

---

### 九、选型理由总结表

| 层级   | 技术                  | 选型理由                       |
| ------ | --------------------- | ------------------------------ |
| 前端   | React Native + Expo   | 快速跨平台开发，学习成本低     |
| 后端   | FastAPI               | 高性能异步框架，Python生态友好 |
| 智能体 | LangGraph + LangChain | 支持多阶段智能体编排与状态流转 |
| 数据库 | PostgreSQL            | 稳定可靠，支持地理扩展         |
| 缓存   | Redis                 | 提升上下文交互效率             |
| 知识库 | Qdrant                | 高性能向量检索与偏好建模       |
| 模型   | OpenAI / Ollama       | 支持在线与本地大模型调用       |
| 部署   | Docker / Render       | 快速部署与展示                 |

---

### 十、扩展与创新方向

1. **知识库自学习** ：用户旅行后总结更新知识图谱，形成个性化推荐；
2. **情境对话记忆** ：多阶段智能体共享记忆，提升连贯体验；
3. **多模态扩展** ：后续可接入图像识别（识别景点、菜品）；
4. **社交共享功能** ：生成旅行报告卡片，一键分享到社区。

---

是否希望我在此基础上，帮你生成一份

🎨「系统架构图 + 智能体分层图（可放入论文中）」？

我可以输出为高清 SVG/PNG 架构图（含前端、后端、LangGraph流、数据库与模型调用流）。
