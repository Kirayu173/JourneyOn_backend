完善行程阶段 (trip_stages) 管理：

任务1.1 (Service层)：修改 app/services/trip_service.py 中的 create_trip 函数。在创建 Trip 记录后，自动为其创建关联的三条 TripStage 记录（pre, on, post），初始状态可设为 'pending'（'pre' 可设为 'in_progress'），如数据库设计文档示例所示。

任务1.2 (Service层/API层)：实现更新 TripStage 状态的功能。可以创建一个新的服务函数 update_stage_status(db, trip_id, user_id, stage_name, new_status)，并在 app/api/routes/trips.py 中添加一个 PATCH /api/trips/{trip_id}/stages/{stage_name} 端点来调用它。这对于跟踪每个阶段（如 pre 阶段规划完成）的状态很有用。 （注意：之前实现的 PATCH /api/trips/{trip_id}/stage 只是更新了 trips 表的 current_stage 字段，并未涉及 trip_stages 表的状态）。

实现基础知识库 (kb_entries) CRUD：

任务2.1 (Service/Schema/API)：创建 app/services/kb_service.py，app/schemas/kb_schemas.py 和 app/api/routes/kb.py。实现基本的 CRUD 功能（创建、读取列表、读取单个条目、更新、删除），操作 kb_entries 表。此阶段仅处理 title, content, source, metadata 等字段， 暂时忽略 embedding_id 或向量相关操作。这允许我们预先填充一些结构化知识。

(可选) 实现用户标签 (user_tags) CRUD：

任务3.1 (Service/Schema/API)：类似地，为 user_tags 表 创建 Service, Schema 和 API 路由 (/api/users/me/tags 或 /api/tags)。允许读取和（可能）手动管理用户的偏好标签。虽然这些标签主要由 Post-Trip Agent 生成，但提供基础管理接口可能有助于调试和展示。

建议优先级： 强烈建议优先完成 任务 1 (完善行程阶段管理)，因为它直接关系到核心业务流程的状态跟踪，并且是对现有 Trip 功能的自然扩展。之后可以进行 任务 2 (基础知识库 CRUD)。任务 3 可以根据需要决定是否在本阶段完成。