太好了！基于你们现在的架构与“线性三阶段智能体”（Pre → On → Post）的目标，下面是 **每个阶段智能体应该具备的功能清单** （分“必备”“增强”“数据/依赖”三类）。我结合了主流旅行产品与研究的通用做法，并给出对应来源，方便你把功能落到实现与验收。

---

# Pre-Trip（行前）Agent：规划、约束收集与方案出稿

**必备功能**

* **目标与约束收集** ：行程天数、预算、同行人、偏好（美食/亲子/徒步）、不可行时间段；存档为后续检索的结构化上下文。

  *理由：高成功率的行程规划从明确约束开始，后续筛选/过滤依赖这些结构化字段。* （UX 研究强调提供行业特定筛选与详细信息对决策至关重要。）([Baymard Institute](https://baymard.com/blog/travel-site-ux-best-practices?utm_source=chatgpt.com "Travel Site UX: 5 Best Practices – Baymard Institute"))
* **草案行程生成** ：围绕锚点（如“先去某地地标”）自动填充半天/全天路线，支持一键换一版。

  *参考：Google Trips/Travel 围绕已知景点一键生成“Day Plan”，并能按上午/下午/整天切换。* ([blog.google](https://blog.google/products/travel/see-more-plan-less-try-google-trips/?utm_source=chatgpt.com "See more, plan less – try Google Trips"))

* **预订信息归集** ：把机酒车/餐厅确认单统一到“行程时间线/票夹”，支持无网查看。

  *参考：Google 旅行把 Gmail 中的预订统一进时间线，且可离线包。* ([blog.google](https://blog.google/products/travel/planning-trip-google-can-help/?utm_source=chatgpt.com "An easier way to plan and organize your trips with Google"))

* **预算/选择对比** ：同一目的地多酒店/体验的价格、评分、位置地图化比对（强制“地图 + 第三方评价链接”）。

  *理由：旅行电商 UX 要点包含地图与第三方评价对决策显著影响。* ([Baymard Institute](https://baymard.com/blog/travel-site-ux-best-practices?utm_source=chatgpt.com "Travel Site UX: 5 Best Practices – Baymard Institute"))

* **天气/季节提示** ：按出行日期给出目的地天气概览与装备建议，写入待办清单。([blog.google](https://blog.google/products/travel/planning-trip-google-can-help/?utm_source=chatgpt.com "An easier way to plan and organize your trips with Google"))

**增强功能**

* **签证/证件与风险清单** ：按目的地生成办签与携带清单（可与 KB 规则结合）。
* **多版本方案管理** ：A/B/C 方案与差异高亮；支持与同伴协作确认。
* **可持续选项提示** ：如碳足迹信息（机票）。*TripIt 提供碳足迹展示作为参考做法。* ([TripIt](https://www.tripit.com/web/free?utm_source=chatgpt.com "TripIt - A single (free) itinerary created for you in seconds"))

**数据/依赖**

* KB 检索（目的地要点、签证常识）、地图/POI、酒店与航班 Provider；离线包准备；行程草案与约束入库待“On-Trip”复用。
* UX 要求：丰富过滤器、详情页地图、第三方评价外链。([Baymard Institute](https://baymard.com/blog/travel-site-ux-best-practices?utm_source=chatgpt.com "Travel Site UX: 5 Best Practices – Baymard Institute"))

---

# On-Trip（在途）Agent：实时陪伴、动态改签与本地化推荐

**必备功能**

* **行程变更与航班告警** ：起飞前后与当日实时推送延误/登机口变化/取消，并给出**可替代航班**与 **值机提醒** ；靠近机场时触发提醒。

  *参考：TripIt Pro 的实时航班告警、替代航班搜索、值机提醒、靠近机场的登机口通知。* ([TripIt](https://help.tripit.com/en/support/solutions/articles/103000063296-flight-alerts?utm_source=chatgpt.com "Flight alerts : TripIt"))

* **“现在出发”/出门提醒** ：基于**当前位置 + 航班状态 + 实时路况**计算出发时间，含倒计时与到达 ETA。

  *参考：TripIt “Go Now”。* ([TripIt](https://help.tripit.com/en/support/solutions/articles/103000063349-go-now?utm_source=chatgpt.com "Go Now : TripIt"))

* **离线可用能力** ：离线地图/导航与已下载行程单、票证；在弱网环境不中断核心能力。

  *参考：OsmAnd 的完全离线地图/导航能力为行业通行做法。* ([维基百科](https://en.wikipedia.org/wiki/OsmAnd?utm_source=chatgpt.com "OsmAnd"))

* **本地推荐与即时检索** ：围绕用户当前地点给出“附近可做的事/餐饮”，并能换一版、按时段/时长筛选。

  *参考：Google 旅行/地图的“就近玩法/日程块”与继续规划支持。* ([blog.google](https://blog.google/products/travel/planning-trip-google-can-help/?utm_source=chatgpt.com "An easier way to plan and organize your trips with Google"))

* **安全与通知** ：天气突发/本地事件提醒；应急联系与位置共享开关。

  *行业趋势强调“实时更新与安全提示、离线应急信息”是现代旅行 App 的刚需能力。* ([AppStudio](https://www.appstudio.ca/blog/travel-app-features/?utm_source=chatgpt.com "9 Must-Have Travel App Features for Modern Traveler's Safety"))

**增强功能**

* **行程动态重排** ：因延误/天气/临时关闭，自动给出当日备选方案并一键替换到时间线。
* **出行方式联动** ：步行/公交/网约车衔接建议与费用/时间对比。
* **翻译/菜单识别** ：相机识别与常用语。

**数据/依赖**

* 航班/路况/天气实时源；地理反向编码与 POI；离线地图数据；权限与定位策略。
* 安全侧：双因子与端到端加密在旅行场景被推荐为必备（公共 Wi-Fi 风险）。([JPLoft](https://www.jploft.com/blog/travel-app-security-guide?utm_source=chatgpt.com "A Quick Guide to Travel App Security"))

---

# Post-Trip（回程后）Agent：总结、学习偏好与资产沉淀

**必备功能**

* **自动总结与时间线归档** ：按实际发生的行程（含变更）生成“旅程报告”，可导出/分享。
* **偏好抽取与标签写回** ：从对话与反馈中提取“偏好标签（徒步/美食/博物馆/避长途步行等）”，写入用户画像用于下次规划。
* **文档与票据归档** ：照片、PDF、二维码归档到单一旅程资产夹；下次可复用签证资料清单。

  *参考：TripIt 提供“Documents/Travel Stats”与碳足迹统计，为回顾与资产沉淀提供方向。* ([TripIt](https://www.tripit.com/web/free?utm_source=chatgpt.com "TripIt - A single (free) itinerary created for you in seconds"))

**增强功能**

* **费用与里程统计** ：花费分类、城市/国家计数、最常用航空/酒店等“旅程统计”。*同样可参考 TripIt 的统计模块。* ([TripIt](https://www.tripit.com/web/free?utm_source=chatgpt.com "TripIt - A single (free) itinerary created for you in seconds"))
* **“下次更好”改进建议** ：基于本次痛点（如换乘紧张/排队过长）给出下次的约束建议（更长缓冲、更早订、避开高峰）。

**数据/依赖**

* 会话与行程实际轨迹/变更记录；照片与文件存储；用户标签与 KB 的写回策略（RAG 的“长期记忆”沉淀）。

---

## 面向你们“线性编排”的落地提示

* **阶段推进的交互** ：在 Pre/On/ Post 之间，用“ **用户确认** ”作为硬门槛（按钮或特定语义确认），并把**阶段历史**暴露给前端以便回放和追踪（你们的新 orchestrator/stream 已支持）。
* **每阶段都必须暴露结构化输出** ：`{reply, tasks, itinerary_deltas, alerts, references}`，便于持久化和 UI 直出。
* **离线优先** ：On-Trip 的关键能力（地图/票据/应急信息）要保证无网可用；参考 OsmAnd 的做法把“下载离线包”做成显式操作。([维基百科](https://en.wikipedia.org/wiki/OsmAnd?utm_source=chatgpt.com "OsmAnd"))
* **航旅“硬需求”优先级最高** ：实时航班告警、替代航班、出发倒计时被验证为高价值刚需，优先实现。([TripIt](https://help.tripit.com/en/support/solutions/articles/103000063296-flight-alerts?utm_source=chatgpt.com "Flight alerts : TripIt"))
* **规划期“减少负担”** ：围绕锚点生成计划、自动汇总预订、地图与第三方评价直达，是用户做决定的关键捷径。([blog.google](https://blog.google/products/travel/see-more-plan-less-try-google-trips/?utm_source=chatgpt.com "See more, plan less – try Google Trips"))

---

### 小结

* **Pre-Trip** ：收集约束 → 生成/对比草案 → 汇集预订 → 天气/装备 → 决策辅助。([blog.google](https://blog.google/products/travel/see-more-plan-less-try-google-trips/?utm_source=chatgpt.com "See more, plan less – try Google Trips"))
* **On-Trip** ：实时告警与“现在出发” → 离线可用 → 附近推荐 → 安全与动态重排。([TripIt](https://help.tripit.com/en/support/solutions/articles/103000063296-flight-alerts?utm_source=chatgpt.com "Flight alerts : TripIt"))
* **Post-Trip** ：报告与资产归档 → 偏好标签写回 → 统计与复用。([TripIt](https://www.tripit.com/web/free?utm_source=chatgpt.com "TripIt - A single (free) itinerary created for you in seconds"))

如果你愿意，我可以把这份清单转成**阶段→功能→API/数据依赖→验收用例**的工程化表格（Markdown/CSV），直接给到各模块 owner 执行。
